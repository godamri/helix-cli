package entity

import (
	"fmt"
	"runtime"
	
	"github.com/godamri/helix-fnd/http/response"
)

// Mapping internal codes to Helix Standard Codes
// Jangan ngarang kode error sendiri. Pake yang ada di helix-fnd/http/response.
const (
	EINTERNAL = response.ErrSystem
	ECONFLICT = response.ErrConflict
	EINVALID  = response.ErrValidation
	ENOTFOUND = response.ErrNotFound
)

type AppError struct {
	Code    string
	Message string
	File    string
	Line    int
	Err     error
}

func (e *AppError) Error() string {
	// Keep logs clean, but allow unwrapping
	if e.Err != nil {
		return fmt.Sprintf("[%s] %s: %v", e.Code, e.Message, e.Err)
	}
	return fmt.Sprintf("[%s] %s", e.Code, e.Message)
}

func (e *AppError) Unwrap() error { return e.Err }

func WrapError(code, msg string, err error) *AppError {
	_, file, line, _ := runtime.Caller(1)
	return &AppError{
		Code:    code,
		Message: msg,
		File:    file,
		Line:    line,
		Err:     err,
	}
}

var (
	ErrNotFound = &AppError{Code: ENOTFOUND, Message: "resource not found"}
	ErrInternal = &AppError{Code: EINTERNAL, Message: "unexpected internal failure"}
)