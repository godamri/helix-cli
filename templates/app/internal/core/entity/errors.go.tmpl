package entity

import (
	"fmt"
	"runtime"
)

const (
	EINTERNAL = "internal_error"
	ECONFLICT = "resource_conflict"
	EINVALID  = "invalid_input"
	ENOTFOUND = "resource_not_found"
)

type AppError struct {
	Code    string
	Message string
	File    string
	Line    int
	Err     error
}

func (e *AppError) Error() string {
	return fmt.Sprintf("[%s] %s (at %s:%d): %v", e.Code, e.Message, e.File, e.Line, e.Err)
}

func (e *AppError) Unwrap() error { return e.Err }

func WrapError(code, msg string, err error) *AppError {
	_, file, line, _ := runtime.Caller(1)
	return &AppError{
		Code:    code,
		Message: msg,
		File:    file,
		Line:    line,
		Err:     err,
	}
}

var (
	ErrNotFound = &AppError{Code: ENOTFOUND, Message: "resource not found"}
	ErrInternal = &AppError{Code: EINTERNAL, Message: "unexpected internal failure"}
)